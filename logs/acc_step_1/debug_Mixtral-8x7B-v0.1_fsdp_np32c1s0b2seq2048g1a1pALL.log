HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 2 --seq_length 2048 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro --compile
Running on device: cuda:4 is_deepspeed: False
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Running on device: cuda:6 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:3 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.35it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.02it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.86it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.57it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.46it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.31it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.65it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.05it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.36it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.04it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.86it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.14it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.04it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.82it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.21it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.37it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.51it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.02it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.67it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.50it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.32it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.70it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.78it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.15it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.77it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.98it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.61it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  7.49it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.98it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.99it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.20it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.90it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.11it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.71it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.08it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.11it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.58it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.17it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.97it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.17it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.12it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.81it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.18it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.55it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.16it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.04it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.20it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.16it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.24it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.90it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.51it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.16it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.08it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.22it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.27it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.17it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.96it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.50it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.11it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.23it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.29it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.18it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.00it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.47it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.13it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.13it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.23it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.30it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.19it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.04it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.47it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.12it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.14it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.05it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.49it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.11it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.03it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.52it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.20it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.14it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.10it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.18it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.04it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.20it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.08it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.54it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.08it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.17it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.15it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.58it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.11it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.24it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.19it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.18it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.29it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.12it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.36it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.30it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.06it/s]
Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.19it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:02<00:00,  6.07it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.22it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.23it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.13it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.41it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:42,  2.37s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.22it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.26it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.19it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.14it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.40it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.17it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.23it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.02it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.29it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.16it/s]
Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  5.25it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.23it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.09it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.16it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.93it/s]
Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  4.78it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  4.53it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:03<00:00,  4.41it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:03<00:00,  6.10it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:04<00:37,  2.21s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:06<00:34,  2.18s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:08<00:32,  2.13s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:10<00:28,  2.02s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:12<00:25,  1.94s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:14<00:22,  1.87s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:15<00:20,  1.84s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:17<00:18,  1.81s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:19<00:16,  1.79s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:21<00:14,  1.78s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:22<00:12,  1.77s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:24<00:10,  1.79s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:26<00:08,  1.79s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:28<00:07,  1.79s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:29<00:05,  1.77s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:31<00:03,  1.75s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:33<00:01,  1.75s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:34<00:00,  1.68s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:34<00:00,  1.84s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
[rank2]:W1217 12:13:03.705000 247679 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank7]:W1217 12:13:03.705000 247684 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank4]:W1217 12:13:03.705000 247681 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank3]:W1217 12:13:03.705000 247680 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank6]:W1217 12:13:03.706000 247683 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank1]:W1217 12:13:03.706000 247678 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank5]:W1217 12:13:03.706000 247682 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank0]:W1217 12:13:04.095000 247677 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
Epoch 1, Step 10, Loss: 8.573112487792969 sync: True time: 5.258261680603027 alloc_mem: 24469857280 peak_mem: 33900504064
Epoch 1, Step 20, Loss: 0.06092509627342224 sync: True time: 5.281664848327637 alloc_mem: 24469857280 peak_mem: 33900504064
Epoch 1, Step 30, Loss: 0.06392646580934525 sync: True time: 5.281489133834839 alloc_mem: 24469857280 peak_mem: 33901372416
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=2 seq=2048 zero_stage=3 acc=1 ac=True compile=True schedule=False passes=None compile_time=0 iteration time: 5.1387 alloc_mem: 24469857280 peak_mem: 33901372416
[rank0]:[W1217 12:16:26.180799027 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
