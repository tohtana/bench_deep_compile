HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 4 --seq_length 512 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro --compile
Running on device: cuda:4 is_deepspeed: False
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:6 is_deepspeed: False
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:3 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Running on device: cuda:2 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.21it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.24it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.65it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.28it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.86it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.89it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.79it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.27it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.28it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.88it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.67it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.63it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.07it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.85it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.33it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.64it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.06it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.72it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.82it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.58it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.30it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.74it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.84it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.55it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.17it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.96it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.85it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.55it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.95it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.95it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.78it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  7.41it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.01it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.04it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.69it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.08it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.02it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.94it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.55it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.12it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.10it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.78it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.15it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.08it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.97it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.62it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.18it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.14it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.16it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.84it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.10it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.04it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.68it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.23it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.18it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.19it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.88it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.13it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.09it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.72it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.25it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.21it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.22it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.15it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.86it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.13it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.75it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.28it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.25it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.85it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.16it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.74it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.29it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.27it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.17it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.88it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.30it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.76it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.28it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.92it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.77it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.29it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.93it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.26it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.77it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.30it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.21it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  7.98it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.96it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.26it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.79it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.30it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.21it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.10it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  7.97it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.27it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.05it/s]
Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.29it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  7.78it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.18it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.20it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  7.97it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.31it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.30it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  7.79it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:42,  2.36s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.25it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.22it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  7.99it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.32it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.28it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  7.80it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.23it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.04it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.22it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.00it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.34it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.14it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.31it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.15it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  7.80it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.23it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.04it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.01it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.80it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.82it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.64it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:04<00:38,  2.26s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:06<00:35,  2.20s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:08<00:31,  2.10s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:10<00:28,  2.02s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:12<00:25,  1.95s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:14<00:22,  1.90s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:15<00:20,  1.87s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:17<00:18,  1.85s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:19<00:16,  1.83s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:21<00:14,  1.82s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:23<00:12,  1.81s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:24<00:10,  1.83s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:26<00:09,  1.81s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:28<00:07,  1.80s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:30<00:05,  1.79s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:32<00:03,  1.77s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:33<00:01,  1.77s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:35<00:00,  1.69s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:35<00:00,  1.86s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
[rank4]:W1217 13:27:26.421000 270780 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank1]:W1217 13:27:26.421000 270777 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank7]:W1217 13:27:26.421000 270783 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank5]:W1217 13:27:26.421000 270781 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank3]:W1217 13:27:26.421000 270779 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank2]:W1217 13:27:26.422000 270778 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank6]:W1217 13:27:26.422000 270782 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank0]:W1217 13:27:26.475000 270776 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
Epoch 1, Step 10, Loss: 3.005974054336548 sync: True time: 3.9207589626312256 alloc_mem: 24208335360 peak_mem: 33557353472
Epoch 1, Step 20, Loss: 1.112813115119934 sync: True time: 3.897367477416992 alloc_mem: 24208335360 peak_mem: 33557353472
Epoch 1, Step 30, Loss: 0.2988912761211395 sync: True time: 3.897930145263672 alloc_mem: 24208335360 peak_mem: 33557353472
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=4 seq=512 zero_stage=3 acc=1 ac=True compile=True schedule=False passes=None compile_time=0 iteration time: 3.7805 alloc_mem: 24208335360 peak_mem: 33557353472
[rank0]:[W1217 13:30:02.865497703 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
