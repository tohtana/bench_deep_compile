HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 1 --seq_length 512 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro --compile
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Running on device: cuda:3 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:4 is_deepspeed: False
Running on device: cuda:6 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.26it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.36it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.08it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.48it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.18it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.59it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.40it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.20it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.40it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.25it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.55it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.46it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.10it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.44it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.57it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.82it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.77it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.97it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.94it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.86it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.50it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.77it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.81it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.03it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.26it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.98it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.06it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  7.48it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.85it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.17it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.96it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.40it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.11it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.18it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.61it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.76it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.25it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.10it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.53it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.27it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.26it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.75it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.33it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.20it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.63it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.37it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.36it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  6.69it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.89it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.39it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.28it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.67it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.44it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.24it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.95it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.42it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.34it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.72it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.49it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.36it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  5.71it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.02it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:43,  2.40s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.44it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.73it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.36it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.53it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.43it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.07it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.73it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.47it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  5.41it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.56it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.45it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.08it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.75it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.47it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.57it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.46it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.10it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.75it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  5.16it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.48it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.58it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.47it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.76it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.10it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.49it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.59it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.49it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  5.12it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.77it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.13it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.48it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.58it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.50it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.79it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.49it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.12it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.59it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:02<00:01,  5.15it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.50it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:01<00:00,  8.79it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.50it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.13it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.60it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.40it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.52it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.80it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:02<00:01,  5.19it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.51it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.14it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.60it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.40it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.53it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.82it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.59it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.52it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.31it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.61it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.40it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.13it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.41it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.22it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.53it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.33it/s]
Loading checkpoint shards:  74%|███████▎  | 14/19 [00:02<00:00,  5.22it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.15it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.93it/s]
Loading checkpoint shards:  79%|███████▉  | 15/19 [00:02<00:00,  5.26it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  5.28it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  5.31it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:03<00:00,  5.32it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:03<00:00,  5.37it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:03<00:00,  5.71it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:04<00:39,  2.30s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:06<00:35,  2.20s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:08<00:32,  2.20s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:10<00:28,  2.07s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:12<00:25,  1.97s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:14<00:22,  1.90s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:16<00:20,  1.86s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:17<00:18,  1.83s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:19<00:16,  1.81s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:21<00:14,  1.80s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:23<00:12,  1.78s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:24<00:10,  1.80s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:26<00:08,  1.80s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:28<00:07,  1.79s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:30<00:05,  1.78s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:31<00:03,  1.76s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:33<00:01,  1.75s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:35<00:00,  1.68s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:35<00:00,  1.85s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
[rank3]:W1217 06:24:10.314000 135066 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank5]:W1217 06:24:10.316000 135068 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank4]:W1217 06:24:10.316000 135067 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank1]:W1217 06:24:10.316000 135064 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank7]:W1217 06:24:10.316000 135070 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank6]:W1217 06:24:10.316000 135069 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank2]:W1217 06:24:10.316000 135065 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank0]:W1217 06:24:10.368000 135063 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
Epoch 1, Step 10, Loss: 0.5542407631874084 sync: True time: 3.418071746826172 alloc_mem: 24011047936 peak_mem: 33308958720
Epoch 1, Step 20, Loss: 0.277884304523468 sync: True time: 3.4329612255096436 alloc_mem: 24011047936 peak_mem: 33308958720
Epoch 1, Step 30, Loss: 0.20910829305648804 sync: True time: 3.404677152633667 alloc_mem: 24011047936 peak_mem: 33308958720
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=1 seq=512 zero_stage=3 acc=1 ac=True compile=True schedule=False passes=None compile_time=0 iteration time: 3.3046 alloc_mem: 24011047936 peak_mem: 33308958720
[rank0]:[W1217 06:26:30.805804200 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
