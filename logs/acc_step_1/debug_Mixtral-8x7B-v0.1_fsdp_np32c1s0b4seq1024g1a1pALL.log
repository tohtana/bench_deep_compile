HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 4 --seq_length 1024 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro --compile
Running on device: cuda:4 is_deepspeed: False
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:6 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:3 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.33it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.39it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.33it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.80it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.09it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.30it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.07it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.38it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.31it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.04it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.25it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.34it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.02it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.97it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.80it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.31it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.17it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.74it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.76it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.19it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.33it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.03it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.71it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.26it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.00it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.69it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.72it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.51it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.97it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.91it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.32it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.14it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.95it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.93it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.62it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.04it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.02it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.35it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.22it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.09it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.07it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.15it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.09it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.68it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.37it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.28it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.19it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.15it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.23it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.14it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.39it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.56it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.32it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.26it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.21it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.28it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.40it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.89it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.53it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.35it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.30it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.26it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.32it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.40it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.98it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.36it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.65it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.30it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.29it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.34it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.41it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.07it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.74it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.33it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.30it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.42it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.11it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.79it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.34it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.42it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.16it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.83it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.40it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.40it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.86it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.34it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.41it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.21it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.34it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.85it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:36,  2.05s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.20it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  7.87it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.41it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.27it/s]
Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.22it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.38it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.34it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.33it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  7.88it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.25it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.36it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.34it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  7.90it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.40it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.21it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.25it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.23it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.37it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.36it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.16it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  7.88it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.27it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.07it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.20it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.90it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.70it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:03<00:33,  1.95s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:05<00:29,  1.86s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:07<00:26,  1.78s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:08<00:23,  1.71s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:10<00:21,  1.67s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:12<00:19,  1.63s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:13<00:17,  1.61s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:15<00:15,  1.59s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:16<00:14,  1.60s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:18<00:12,  1.59s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:19<00:11,  1.58s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:21<00:09,  1.59s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:23<00:07,  1.58s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:24<00:06,  1.61s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:26<00:04,  1.59s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:27<00:03,  1.57s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:29<00:01,  1.56s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:31<00:00,  1.85s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:31<00:00,  1.68s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
[rank5]:W1217 14:38:22.881000 293009 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank3]:W1217 14:38:22.882000 293007 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank2]:W1217 14:38:22.882000 293006 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank6]:W1217 14:38:22.882000 293010 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank4]:W1217 14:38:22.882000 293008 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank1]:W1217 14:38:22.883000 293005 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank7]:W1217 14:38:22.883000 293011 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank0]:W1217 14:38:22.939000 293004 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
Epoch 1, Step 10, Loss: 0.13435767590999603 sync: True time: 5.149353742599487 alloc_mem: 24465683456 peak_mem: 33887991296
Epoch 1, Step 20, Loss: 1.00557541847229 sync: True time: 5.146762847900391 alloc_mem: 24465683456 peak_mem: 33887991296
Epoch 1, Step 30, Loss: 0.1520024538040161 sync: True time: 5.205235242843628 alloc_mem: 24465683456 peak_mem: 33887991296
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=4 seq=1024 zero_stage=3 acc=1 ac=True compile=True schedule=False passes=None compile_time=0 iteration time: 5.0314 alloc_mem: 24465683456 peak_mem: 33887991296
[rank0]:[W1217 14:41:43.869866062 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
