HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 1 --seq_length 1024 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro --compile
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:4 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:3 is_deepspeed: False
Running on device: cuda:6 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.54it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.63it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.50it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.04it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.65it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.51it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.17it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.98it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.90it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:01,  8.05it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.26it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.40it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.10it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.95it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.15it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.13it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.26it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.75it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.84it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.48it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.08it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.64it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.26it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.01it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.09it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.16it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.68it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.54it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.90it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.31it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.16it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.26it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.34it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.80it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.78it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.05it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.37it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.26it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.40it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.46it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.91it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.84it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.15it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.40it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.45it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.32it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.54it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.00it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.90it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.21it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.42it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.50it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.59it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.36it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.06it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.93it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.25it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.47it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.55it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.62it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.38it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.11it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.27it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.93it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.50it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.58it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.65it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.42it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.13it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.29it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.95it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.51it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.66it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.58it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.43it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.15it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.51it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.67it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.60it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.95it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.44it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.16it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.52it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.68it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.62it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.95it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.44it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.54it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.16it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.69it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.63it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.45it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.98it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.70it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.56it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.62it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.17it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.33it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.46it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.04it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.70it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.54it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.62it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.18it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.45it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.08it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:37,  2.08s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.71it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.55it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.63it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.46it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.07it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.71it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.57it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.38it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.65it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.45it/s]
Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.31it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.18it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.45it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.05it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.74it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.51it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.32it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.19it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.49it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.29it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.03it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.32it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.16it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.19it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.03it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.88it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.17it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.02it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:03<00:33,  1.98s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:05<00:30,  1.89s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:07<00:27,  1.82s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:09<00:24,  1.75s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:10<00:21,  1.69s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:12<00:19,  1.65s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:13<00:17,  1.63s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:15<00:16,  1.61s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:17<00:14,  1.62s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:18<00:12,  1.61s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:20<00:11,  1.63s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:22<00:09,  1.67s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:23<00:08,  1.68s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:25<00:06,  1.71s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:27<00:05,  1.69s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:28<00:03,  1.66s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:30<00:01,  1.63s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:31<00:00,  1.56s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:31<00:00,  1.67s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
[rank3]:W1217 07:31:38.260000 157407 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank6]:W1217 07:31:38.260000 157410 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank1]:W1217 07:31:38.260000 157405 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank4]:W1217 07:31:38.260000 157408 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank2]:W1217 07:31:38.261000 157406 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank5]:W1217 07:31:38.261000 157409 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank7]:W1217 07:31:38.261000 157411 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank0]:W1217 07:31:38.320000 157404 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
Epoch 1, Step 10, Loss: 21.6467227935791 sync: True time: 3.477438449859619 alloc_mem: 24076592128 peak_mem: 33393348608
Epoch 1, Step 20, Loss: 0.14871995151042938 sync: True time: 3.4691762924194336 alloc_mem: 24076592128 peak_mem: 33393348608
Epoch 1, Step 30, Loss: 0.1273713856935501 sync: True time: 3.4489822387695312 alloc_mem: 24076592128 peak_mem: 33393348608
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=1 seq=1024 zero_stage=3 acc=1 ac=True compile=True schedule=False passes=None compile_time=0 iteration time: 3.3610 alloc_mem: 24076592128 peak_mem: 33393348608
[rank0]:[W1217 07:34:00.481826967 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
