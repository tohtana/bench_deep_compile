HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 4 --seq_length 2048 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:3 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:4 is_deepspeed: False
Running on device: cuda:6 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.40it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.24it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.04it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.39it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.08it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.14it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.03it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.94it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.17it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.90it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.78it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.23it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.17it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.50it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.08it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.63it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.05it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.01it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.70it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.64it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.54it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  7.46it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.86it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.50it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.14it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.95it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.89it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.78it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.60it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.00it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.77it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.22it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.09it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.03it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.91it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.75it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.09it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.88it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.26it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.18it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.12it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.00it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.89it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.15it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.30it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.97it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.24it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.18it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.05it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.96it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.19it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.32it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.03it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.27it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.22it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.09it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.01it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.21it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.35it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.05it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.30it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.24it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.11it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.06it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.23it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.34it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.08it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.33it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.27it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.13it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.08it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.10it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.34it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.28it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.13it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.11it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.08it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.28it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.13it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.11it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.25it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.11it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.29it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.14it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.26it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.12it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.11it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.30it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.16it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.27it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.14it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.09it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.30it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.16it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.26it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.14it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.13it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.29it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.16it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.40it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.28it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.18it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.36it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.15it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.30it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.23it/s]
Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.15it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.24it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.18it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.34it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.16it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.23it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.16it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.28it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.11it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.22it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.95it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.37it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.20it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.18it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:42,  2.35s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.21it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.12it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.16it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.00it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.20it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.99it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:04<00:38,  2.26s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:06<00:34,  2.16s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:08<00:29,  1.97s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:09<00:26,  1.86s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:11<00:23,  1.84s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:13<00:21,  1.82s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:15<00:19,  1.79s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:16<00:17,  1.73s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:18<00:15,  1.70s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:20<00:13,  1.67s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:21<00:11,  1.64s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:23<00:09,  1.63s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:24<00:08,  1.62s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:26<00:06,  1.64s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:28<00:04,  1.61s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:29<00:03,  1.60s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:31<00:01,  1.59s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:32<00:00,  1.54s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:32<00:00,  1.72s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Epoch 1, Step 10, Loss: 0.12897297739982605 sync: True time: 7.523240804672241 alloc_mem: 24994210816 peak_mem: 34575852544
Epoch 1, Step 20, Loss: 0.07750976830720901 sync: True time: 7.510472297668457 alloc_mem: 24994210816 peak_mem: 34576901120
Epoch 1, Step 30, Loss: 0.07010364532470703 sync: True time: 7.5372231006622314 alloc_mem: 24994210816 peak_mem: 34576901120
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=4 seq=2048 zero_stage=3 acc=1 ac=True compile=False schedule=False passes=None compile_time=0 iteration time: 7.3469 alloc_mem: 24994210816 peak_mem: 34576901120
[rank0]:[W1217 15:55:54.496834071 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
