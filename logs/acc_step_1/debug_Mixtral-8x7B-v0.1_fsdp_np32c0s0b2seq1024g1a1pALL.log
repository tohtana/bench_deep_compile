HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 2 --seq_length 1024 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:3 is_deepspeed: False
Running on device: cuda:6 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:4 is_deepspeed: False
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.12it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.63it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.56it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.25it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.25it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.03it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:04,  4.33it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.04it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.98it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.86it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.24it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.70it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.20it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.56it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.94it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.42it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.62it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.93it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.87it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.36it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.30it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:04,  3.90it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.73it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.82it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.06it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.05it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.57it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  7.47it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.92it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.91it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.14it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.16it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.83it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.02it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.27it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.99it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:04,  3.72it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.20it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.24it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.97it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.10it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.42it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.05it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.22it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.29it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.10it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.15it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.59it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.07it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.31it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:01<00:04,  3.71it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.34it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.25it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.19it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.73it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.10it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.39it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.37it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.34it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.20it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.81it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.12it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.42it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.40it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:01<00:03,  3.72it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:43,  2.40s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.22it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.87it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.42it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.07it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.22it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.86it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.88it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:01<00:03,  3.71it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.84it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.96it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.33it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.84it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.04it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:01<00:03,  3.71it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.40it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.06it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.84it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.33it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.31it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.40it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.09it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  7.83it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.24it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.29it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:02<00:02,  3.72it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.12it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.33it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  7.84it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.24it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.30it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.18it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.41it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.19it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.14it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.33it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  7.86it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.25it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.04it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.35it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.14it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.15it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.98it/s]
Loading checkpoint shards:  47%|████▋     | 9/19 [00:02<00:02,  3.73it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  7.87it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.91it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.69it/s]
Loading checkpoint shards:  53%|█████▎    | 10/19 [00:02<00:02,  3.81it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:02<00:02,  3.93it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:03<00:01,  4.01it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:03<00:01,  3.74it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:04<00:38,  2.29s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:03<00:01,  3.59it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:04<00:01,  3.48it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:04<00:00,  3.40it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:04<00:00,  3.37it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:04<00:00,  3.38it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:05<00:00,  3.40it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:05<00:00,  3.62it/s]
Loading checkpoint shards:  16%|█▌        | 3/19 [00:06<00:35,  2.19s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:08<00:31,  2.13s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:10<00:28,  2.05s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:12<00:25,  1.96s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:14<00:22,  1.90s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:15<00:20,  1.86s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:17<00:18,  1.83s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:19<00:16,  1.81s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:21<00:14,  1.81s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:23<00:12,  1.79s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:24<00:10,  1.81s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:26<00:08,  1.80s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:28<00:07,  1.79s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:30<00:05,  1.78s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:31<00:03,  1.78s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:33<00:01,  1.77s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:35<00:00,  1.69s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:35<00:00,  1.86s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Epoch 1, Step 10, Loss: 0.16400398313999176 sync: True time: 3.9647037982940674 alloc_mem: 24206637056 peak_mem: 33557886464
Epoch 1, Step 20, Loss: 0.10800541192293167 sync: True time: 3.961308002471924 alloc_mem: 24206637056 peak_mem: 33558139392
Epoch 1, Step 30, Loss: 0.12715184688568115 sync: True time: 3.9645957946777344 alloc_mem: 24206637056 peak_mem: 33558655488
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=2 seq=1024 zero_stage=3 acc=1 ac=True compile=False schedule=False passes=None compile_time=0 iteration time: 3.8510 alloc_mem: 24206637056 peak_mem: 33558655488
[rank0]:[W1217 10:58:36.939337830 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
