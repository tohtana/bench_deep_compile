HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 1 --seq_length 2048 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro --compile
Running on device: cuda:5 is_deepspeed: False
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:3 is_deepspeed: False
Running on device: cuda:6 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:4 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.37it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.44it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.36it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.88it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.42it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.38it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.12it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.22it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.05it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.84it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.35it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.62it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.25it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.42it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.20it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.97it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.06it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.40it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.33it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.47it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.68it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.58it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.01it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.05it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.63it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.36it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.83it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.78it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  6.54it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.03it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.85it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  7.34it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.32it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.03it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.88it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  6.85it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.16it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.02it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.51it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.32it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.15it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.94it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.24it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.02it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.12it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.63it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.32it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.24it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.98it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.29it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.21it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.12it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.70it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.29it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.99it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.33it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.24it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:01<00:01,  7.21it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.75it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.32it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.01it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.27it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.26it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.77it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.35it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.02it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.29it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.33it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.79it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.29it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.03it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.32it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.33it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.78it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.32it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.03it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.33it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.33it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.82it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.36it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.05it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.35it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.34it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.88it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.38it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.40it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.05it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.32it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.95it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:36,  2.04s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.39it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.05it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.34it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.23it/s]
Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  7.94it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.40it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.36it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.06it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.40it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  7.92it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.43it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.23it/s]
Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.37it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.08it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:02<00:00,  7.41it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.40it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  7.91it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.37it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.08it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  7.42it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.42it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.22it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  7.90it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.40it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.20it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.11it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.95it/s]
Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  7.45it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.91it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.72it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  7.47it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.49it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.24it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:03<00:32,  1.93s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:05<00:29,  1.85s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:07<00:26,  1.76s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:08<00:23,  1.70s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:10<00:21,  1.67s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:12<00:19,  1.63s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:13<00:17,  1.60s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:15<00:15,  1.59s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:16<00:14,  1.60s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:18<00:12,  1.59s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:19<00:10,  1.57s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:21<00:09,  1.57s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:22<00:07,  1.57s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:24<00:06,  1.59s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:26<00:04,  1.57s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:27<00:03,  1.56s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:29<00:01,  1.55s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:31<00:00,  1.71s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:31<00:00,  1.65s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
[rank6]:W1217 08:41:44.556000 180235 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank4]:W1217 08:41:44.556000 180233 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank2]:W1217 08:41:44.556000 180231 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank7]:W1217 08:41:44.557000 180236 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank3]:W1217 08:41:44.557000 180232 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank1]:W1217 08:41:44.557000 180230 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank5]:W1217 08:41:44.558000 180234 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank0]:W1217 08:41:44.612000 180229 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
Epoch 1, Step 10, Loss: 0.10032308846712112 sync: True time: 4.23764967918396 alloc_mem: 24208335360 peak_mem: 33563845632
Epoch 1, Step 20, Loss: 3.706357717514038 sync: True time: 4.212974309921265 alloc_mem: 24208335360 peak_mem: 33563845632
Epoch 1, Step 30, Loss: 0.06347538530826569 sync: True time: 4.239690780639648 alloc_mem: 24208335360 peak_mem: 33563845632
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=1 seq=2048 zero_stage=3 acc=1 ac=True compile=True schedule=False passes=None compile_time=0 iteration time: 4.1361 alloc_mem: 24208335360 peak_mem: 33563845632
[rank0]:[W1217 08:44:30.517143449 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
