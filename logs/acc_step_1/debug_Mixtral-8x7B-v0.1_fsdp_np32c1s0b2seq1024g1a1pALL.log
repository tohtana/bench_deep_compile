HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 2 --seq_length 1024 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro --compile
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:6 is_deepspeed: False
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:3 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Running on device: cuda:4 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.44it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.48it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.92it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.15it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.44it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.26it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.89it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.23it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.27it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.77it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  4.66it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.45it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.89it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.08it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.29it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.33it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.60it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.87it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.39it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.57it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.72it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:03,  5.20it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.41it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.10it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  6.94it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.70it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.84it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.44it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.92it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  5.40it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.20it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.85it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.99it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  7.13it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.46it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.05it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.28it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.97it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.09it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.25it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  5.51it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.47it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.13it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.34it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.16it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.02it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.48it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.32it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.19it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:02,  5.57it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.38it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.19it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.08it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.49it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.22it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.39it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.39it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.22it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.12it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:01<00:02,  5.62it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.50it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.24it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.43it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.41it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.25it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.13it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.50it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.26it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.47it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:01<00:02,  5.66it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.43it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.26it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.50it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.28it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.43it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.49it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  5.69it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.26it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.50it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.17it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.27it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.43it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.51it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.27it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.51it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.28it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  5.70it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.44it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.54it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.51it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.22it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.16it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.28it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.44it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  5.85it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.56it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.53it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.37it/s]
Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.16it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.31it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.46it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.57it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  5.99it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.12it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.21it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.33it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.44it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:02<00:00,  7.58it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.13it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.25it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.37it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:02<00:01,  6.09it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.43it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:43,  2.39s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.28it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.16it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  7.59it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.39it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.45it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.30it/s]
Loading checkpoint shards:  68%|██████▊   | 13/19 [00:02<00:00,  6.25it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.25it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.03it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.19it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.06it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.36it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.17it/s]
Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  7.62it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:02<00:00,  6.55it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  7.64it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:02<00:00,  6.87it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.66it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.43it/s]
Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  7.14it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  7.35it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  7.50it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:03<00:00,  7.62it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:03<00:00,  6.30it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:04<00:39,  2.30s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:06<00:35,  2.20s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:08<00:31,  2.09s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:10<00:28,  2.00s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:12<00:25,  1.93s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:14<00:22,  1.87s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:15<00:20,  1.84s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:17<00:18,  1.82s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:19<00:16,  1.81s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:21<00:14,  1.81s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:22<00:12,  1.80s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:24<00:10,  1.82s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:26<00:09,  1.82s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:28<00:07,  1.82s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:30<00:05,  1.81s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:31<00:03,  1.79s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:33<00:01,  1.79s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:35<00:00,  1.71s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:35<00:00,  1.86s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
[rank2]:W1217 11:00:20.999000 224822 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank4]:W1217 11:00:20.999000 224824 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank6]:W1217 11:00:20.999000 224826 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank5]:W1217 11:00:21.000000 224825 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank3]:W1217 11:00:21.001000 224823 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank1]:W1217 11:00:21.001000 224821 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank7]:W1217 11:00:21.001000 224827 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank0]:W1217 11:00:21.059000 224820 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
Epoch 1, Step 10, Loss: 0.16296720504760742 sync: True time: 4.140825271606445 alloc_mem: 24204292608 peak_mem: 33555926016
Epoch 1, Step 20, Loss: 0.12610268592834473 sync: True time: 4.133650302886963 alloc_mem: 24204292608 peak_mem: 33556365312
Epoch 1, Step 30, Loss: 0.12876377999782562 sync: True time: 4.133761167526245 alloc_mem: 24204292608 peak_mem: 33556365312
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=2 seq=1024 zero_stage=3 acc=1 ac=True compile=True schedule=False passes=None compile_time=0 iteration time: 4.0205 alloc_mem: 24204292608 peak_mem: 33556365312
[rank0]:[W1217 11:03:03.401447920 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
