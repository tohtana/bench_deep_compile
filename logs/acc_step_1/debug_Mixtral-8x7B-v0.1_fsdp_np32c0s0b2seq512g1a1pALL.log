HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 2 --seq_length 512 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:6 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:4 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Running on device: cuda:3 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.60it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.67it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.18it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.98it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:01,  8.08it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.06it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.17it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.95it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.86it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  8.29it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.12it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.92it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.23it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.16it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.12it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.97it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.41it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.49it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.71it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.14it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.54it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.57it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.42it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.48it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.68it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.97it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  7.24it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:02,  7.49it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.82it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.66it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.53it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.12it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.78it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.44it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.68it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.97it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.80it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.57it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.21it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.84it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.57it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.81it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.05it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.59it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.89it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.27it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.90it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.65it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.90it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.12it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.61it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.95it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.31it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.64it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.69it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.16it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.95it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.62it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.98it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.34it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.74it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.18it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.73it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.62it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.97it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.00it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.36it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.85it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.21it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.63it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.77it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.99it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.02it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.89it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.63it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.21it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.01it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  7.78it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.03it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.94it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.63it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.01it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  7.79it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.03it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.99it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.61it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.25it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.08it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  7.81it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.40it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.10it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.62it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.03it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.14it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.82it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  7.47it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.61it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.02it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:36,  2.03s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.18it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  7.83it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.16it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.61it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.49it/s]
Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.03it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.14it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:02<00:00,  6.05it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.38it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  7.84it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.11it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.04it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.11it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.36it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  7.84it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.09it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  5.83it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.05it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.09it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.38it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.22it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.05it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  7.74it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  6.36it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.08it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.85it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.09it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.92it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.05it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.92it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.75it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.64it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  6.83it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.21it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.37it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:03<00:32,  1.94s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:05<00:29,  1.85s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:07<00:26,  1.79s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:08<00:24,  1.72s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:10<00:21,  1.67s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:12<00:19,  1.63s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:13<00:17,  1.60s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:15<00:15,  1.59s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:16<00:14,  1.60s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:18<00:12,  1.59s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:19<00:11,  1.57s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:21<00:09,  1.58s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:23<00:07,  1.58s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:24<00:06,  1.60s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:26<00:04,  1.59s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:27<00:03,  1.57s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:29<00:01,  1.66s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:34<00:00,  2.61s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:34<00:00,  1.81s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Epoch 1, Step 10, Loss: 0.2773166298866272 sync: True time: 3.4537904262542725 alloc_mem: 24072418304 peak_mem: 33386006016
Epoch 1, Step 20, Loss: 0.18951386213302612 sync: True time: 3.481091260910034 alloc_mem: 24072418304 peak_mem: 33386718720
Epoch 1, Step 30, Loss: 0.2529807388782501 sync: True time: 3.501316785812378 alloc_mem: 24072418304 peak_mem: 33386718720
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=2 seq=512 zero_stage=3 acc=1 ac=True compile=False schedule=False passes=None compile_time=0 iteration time: 3.3498 alloc_mem: 24072418304 peak_mem: 33386718720
[rank0]:[W1217 09:50:45.575977574 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
