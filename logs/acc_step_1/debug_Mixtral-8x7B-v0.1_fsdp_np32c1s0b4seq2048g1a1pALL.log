HOST_IP: 10.8.32.99
NUM_NODES: 4
NUM_PROCESSES: 32
BACKEND: fsdp
ZERO_STAGE: 3
MODEL: mistralai/Mixtral-8x7B-v0.1
EXTRA_OPTS: --batch_size 4 --seq_length 2048 --activation_checkpointing --profile --profile_dir /mnt/post-training-ppo/projects/z3n/prof_osdi2025_repro --compile
Running on device: cuda:0 is_deepspeed: False
Loading model and tokenizer...
Running on device: cuda:4 is_deepspeed: False
Running on device: cuda:3 is_deepspeed: False
Running on device: cuda:7 is_deepspeed: False
Running on device: cuda:2 is_deepspeed: False
Running on device: cuda:1 is_deepspeed: False
Running on device: cuda:5 is_deepspeed: False
Running on device: cuda:6 is_deepspeed: False
Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.09it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/19 [00:00<?, ?it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.33it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.22it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.27it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.30it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:02,  6.20it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.77it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.36it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.23it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:00<00:03,  5.92it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.73it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.30it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.17it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  6.89it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.77it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.62it/s]Loading checkpoint shards:  11%|█         | 2/19 [00:00<00:02,  7.07it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.98it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.69it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.58it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.34it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.77it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.83it/s]Loading checkpoint shards:  16%|█▌        | 3/19 [00:00<00:02,  7.54it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.13it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.91it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.78it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.60it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.92it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.96it/s]Loading checkpoint shards:  21%|██        | 4/19 [00:00<00:01,  7.79it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.23it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  8.02it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.90it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.75it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.07it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.03it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.28it/s]Loading checkpoint shards:  26%|██▋       | 5/19 [00:00<00:01,  7.93it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.10it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.98it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  7.83it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.18it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:00<00:01,  8.30it/s]Loading checkpoint shards:  32%|███▏      | 6/19 [00:00<00:01,  8.01it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.80it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.13it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.75it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.26it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  7.90it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.33it/s]Loading checkpoint shards:  37%|███▋      | 7/19 [00:00<00:01,  8.07it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.92it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.16it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.86it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.30it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  7.94it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.36it/s]Loading checkpoint shards:  42%|████▏     | 8/19 [00:01<00:01,  8.12it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.00it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.18it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.95it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.35it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  7.96it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  47%|████▋     | 9/19 [00:01<00:01,  8.15it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.05it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.20it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.00it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.37it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  7.99it/s]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:01<00:01,  8.17it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.10it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.22it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.06it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.38it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:01,  8.00it/s]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:01<00:00,  8.20it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.24it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.10it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.41it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.40it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.01it/s]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:01<00:00,  8.19it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.09it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.40it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.39it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.04it/s]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:01<00:00,  8.22it/s]Loading checkpoint shards:   5%|▌         | 1/19 [00:02<00:38,  2.14s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.15it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.26it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.41it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.11it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.41it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.05it/s]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.17it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.13it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.42it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.11it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.42it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.06it/s]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.18it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.09it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.42it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.08it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.41it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:01<00:00,  8.23it/s]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:02<00:00,  8.06it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.16it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.09it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.17it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.10it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.04it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.17it/s]
Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.21it/s]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:02<00:00,  8.07it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.05it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.14it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.25it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.18it/s]
Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.12it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.22it/s]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:02<00:00,  8.07it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.01it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.97it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.18it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.07it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.15it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.95it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.24it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.05it/s]
Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  8.11it/s]Loading checkpoint shards: 100%|██████████| 19/19 [00:02<00:00,  7.88it/s]
Loading checkpoint shards:  11%|█         | 2/19 [00:04<00:34,  2.04s/it]Loading checkpoint shards:  16%|█▌        | 3/19 [00:05<00:30,  1.93s/it]Loading checkpoint shards:  21%|██        | 4/19 [00:07<00:28,  1.87s/it]Loading checkpoint shards:  26%|██▋       | 5/19 [00:09<00:25,  1.79s/it]Loading checkpoint shards:  32%|███▏      | 6/19 [00:10<00:22,  1.73s/it]Loading checkpoint shards:  37%|███▋      | 7/19 [00:12<00:20,  1.70s/it]Loading checkpoint shards:  42%|████▏     | 8/19 [00:14<00:18,  1.67s/it]Loading checkpoint shards:  47%|████▋     | 9/19 [00:15<00:16,  1.65s/it]Loading checkpoint shards:  53%|█████▎    | 10/19 [00:17<00:14,  1.66s/it]Loading checkpoint shards:  58%|█████▊    | 11/19 [00:19<00:13,  1.65s/it]Loading checkpoint shards:  63%|██████▎   | 12/19 [00:20<00:11,  1.63s/it]Loading checkpoint shards:  68%|██████▊   | 13/19 [00:22<00:09,  1.64s/it]Loading checkpoint shards:  74%|███████▎  | 14/19 [00:23<00:08,  1.63s/it]Loading checkpoint shards:  79%|███████▉  | 15/19 [00:25<00:06,  1.66s/it]Loading checkpoint shards:  84%|████████▍ | 16/19 [00:27<00:04,  1.64s/it]Loading checkpoint shards:  89%|████████▉ | 17/19 [00:28<00:03,  1.63s/it]Loading checkpoint shards:  95%|█████████▍| 18/19 [00:30<00:01,  1.63s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:31<00:00,  1.56s/it]Loading checkpoint shards: 100%|██████████| 19/19 [00:31<00:00,  1.68s/it]
Loading dataset...
NCCL version 2.21.5+cuda12.4
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
Model prepared: <class 'torch.distributed.fsdp.fully_sharded_data_parallel.FullyShardedDataParallel'>
[rank3]:W1217 15:57:31.093000 316993 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank6]:W1217 15:57:31.094000 316996 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank5]:W1217 15:57:31.094000 316995 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank4]:W1217 15:57:31.094000 316994 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank1]:W1217 15:57:31.094000 316991 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank2]:W1217 15:57:31.095000 316992 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank7]:W1217 15:57:31.096000 316997 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
[rank0]:W1217 15:57:32.973000 316990 torch/_logging/_internal.py:1081] [0/0] Profiler function <class 'torch.autograd.profiler.record_function'> will be ignored
Epoch 1, Step 10, Loss: 0.5134381055831909 sync: True time: 7.447963714599609 alloc_mem: 24990822912 peak_mem: 34571965440
Epoch 1, Step 20, Loss: 0.06623439490795135 sync: True time: 7.437892436981201 alloc_mem: 24990822912 peak_mem: 34572563456
Epoch 1, Step 30, Loss: 1.814658522605896 sync: True time: 7.450552463531494 alloc_mem: 24990822912 peak_mem: 34572563456
mistralai/Mixtral-8x7B-v0.1 ds=False np=32 batch_size=4 seq=2048 zero_stage=3 acc=1 ac=True compile=True schedule=False passes=None compile_time=0 iteration time: 7.2603 alloc_mem: 24990822912 peak_mem: 34572563456
[rank0]:[W1217 16:02:00.324021122 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
